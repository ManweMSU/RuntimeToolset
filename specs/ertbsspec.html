<html>
	<head>
		<meta charset="UTF-8">
		<title>Спецификация сценариев сборки</title>
	</head>
	<body style="font-family: 'Courier New', Courier, monospace">
		<h1>Спецификация сценариев сборки</h1>
		<h2>Версия 1.</h2>
		<i>
			Copyright &COPY; Engine Software, Емельянов Д.П. 2025.<br><br>
		</i>
		Файл сценария сборки это текстовый файл в кодировке UTF-8 с расширением ".ertbs".
		Начиная с Engine Runtime 1.10 такие файлы могут числиться в списке компиляции наравне с файлами исходного кода C/C++, UIML и EGSL.
		Сценарии могут использоваться в модулях, но не могут использоваться в ядре Engine Runtime.
		Если каталог модуля содержит файл "module.ertbs", то этот и только этот файл будет добавлен в список сборки при импорте модуля.
		В противном случае все файлы C/C++, UIML, EGSL и ERTBS в каталоге модуля будут добавлены в список сборки.

		<h2>Формат команды</h2>
		<p>
			Пробельными символами считаются символы пробела и табуляции. Каждая строка файла интерпретируется как отдельная команда.
			Если строка не содержит иных символов кроме пробельных или же первым непробельным символом является '#', то строка игнорируется.
			Команда разделяется пробельными символами на аргументы. Для задания аргумента, содержащего внутри себя пробельные символы,
			его следует заключить в одинарные или двойные кавычки ' или ". Внутри такого аргумента последовательности '' и "" заменяются на ' и " соответственно.
			Внешние кавычки не включаются в аргумент.
		</p>
		<p>
			Внутри каждого аргумента производится подстановка переменных:
			подстрока $VAR$ заменяется на значение переменной VAR, если таковая существует, иначе на пустую строку.
			При этом подстрока $$ заменяется на $.
		</p>

		<h2>Базовые команды</h2>
		Именем команды называется её первый аргумент.
		Специальные имена команд вида '&lt;ИМЯ&gt;:' (то есть заканчивающиеся двоеточием) называются метками, при этом последовательность &lt;ИМЯ&gt;
		называется именем метки. Метки игнорируются при исполнении. Они используются как точки условных и безусловных переходов.
		<table>
			<tr>
				<td><b>Команда</b></td>
				<td><b>Число аргументов</b></td>
				<td><b>Описание</b></td>
			</tr>
			<tr>
				<td><b>MKDIR</b></td>
				<td>Любое</td>
				<td>Создаёт деревья каталогов, указанные в аргументах</td>
			</tr>
			<tr>
				<td><b>MV</b></td>
				<td>3</td>
				<td>Переименовывает файл или каталог, заданный второй аргумент, давая ему имя, заданное как третий</td>
			</tr>
			<tr>
				<td><b>CP</b></td>
				<td>3</td>
				<td>Копирует файл, заданный второй аргумент, в файл, заданный как третий</td>
			</tr>
			<tr>
				<td><b>RM</b></td>
				<td>Любое</td>
				<td>Удаляет все файлы (включая деревья файлов и каталогов), указанные в аргументах</td>
			</tr>
			<tr>
				<td><b>COMPILE</b></td>
				<td>Любое</td>
				<td>Добавляет указанные файлы в конец списка компиляции. При этом сборочная система исключает дубликаты файлов, которые там уже есть</td>
			</tr>
			<tr>
				<td><b>DEFINE</b></td>
				<td>Любое</td>
				<td>Добавляет определения препроцессора C/C++. Эта команда влияет только на те файлы, которые будут компилироваться после сценария</td>
			</tr>
			<tr>
				<td><b>INCLUDE</b></td>
				<td>Любое</td>
				<td>Добавляет каталоги поиска включаемых файлов C/C++. Эта команда влияет только на те файлы, которые будут компилироваться после сценария</td>
			</tr>
			<tr>
				<td><b>LINK</b></td>
				<td>Любое</td>
				<td>Добавляет объектный файл в список объектных файлов для линковки</td>
			</tr>
			<tr>
				<td><b>ATTACHMENT</b></td>
				<td>3</td>
				<td>Добавляет файл, заданный как второй аргумент, в приложения собираемой программы под именем, заданным в третьем аргументе</td>
			</tr>
			<tr>
				<td><b>RESOURCE</b></td>
				<td>3</td>
				<td>Добавляет файл, заданный как второй аргумент, в ресурсы собираемой программы под именем, заданным в третьем аргументе</td>
			</tr>
			<tr>
				<td><b>LINKARG</b></td>
				<td>Любое</td>
				<td>Передаёт свои аргументы напрямую линкеру</td>
			</tr>
			<tr>
				<td><b>SET</b></td>
				<td>3</td>
				<td>Создаёт или переопределяет переменную с именем, заданным как второй аргумент, со значением, заданным как третий</td>
			</tr>
			<tr>
				<td><b>EXIT</b></td>
				<td>1</td>
				<td>Завершает (успешно) исполнение сценария</td>
			</tr>
			<tr>
				<td><b>ALERT</b></td>
				<td>Любое</td>
				<td>Добавляет все свои аргументы в лог - они будут напечатаны в консоль после исполнения сценария</td>
			</tr>
			<tr>
				<td><b>FAIL</b></td>
				<td>Любое</td>
				<td>Завершает (не успешно) исполнение сценария, применяя команду ALERT ко всем своим аргументам</td>
			</tr>
			<tr>
				<td><b>GOTO</b></td>
				<td>2</td>
				<td>Совершает безусловный переход на метку, заданную как второй аргумент</td>
			</tr>
			<tr>
				<td><b>IFEQ</b></td>
				<td>4</td>
				<td>Совершает переход на метку, заданную как четвёртый аргумент, если второй и третий аргументы равны</td>
			</tr>
			<tr>
				<td><b>IFNEQ</b></td>
				<td>4</td>
				<td>Совершает переход на метку, заданную как четвёртый аргумент, если второй и третий аргументы не равны</td>
			</tr>
		</table>

		<h2>Определяемые системой сборки переменные</h2>
		Эти переменные определяет система сборки перед запуском сценария
		<table>
			<tr>
				<td><b>Имя</b></td>
				<td><b>Начальное значение</b></td>
			</tr>
			<tr>
				<td><b>PROJROOT</b></td>
				<td>Полный путь к корневому каталогу текущего проекта</td>
			</tr>
			<tr>
				<td><b>OBJROOT</b></td>
				<td>Полный путь к каталогу промежуточных объектов сборки текущего проекта</td>
			</tr>
			<tr>
				<td><b>EXROOT</b></td>
				<td>Полный путь к каталогу вывода текущего проекта</td>
			</tr>
			<tr>
				<td><b>ERTRSRC</b></td>
				<td>Полный путь к каталогу установленных в Engine Runtime ресурсов</td>
			</tr>
			<tr>
				<td><b>ERTMDL</b></td>
				<td>Полный путь к каталогу установленных в Engine Runtime модулей</td>
			</tr>
			<tr>
				<td><b>ARCH</b></td>
				<td>Идентификатор текущей архитектуры процессора</td>
			</tr>
			<tr>
				<td><b>OS</b></td>
				<td>Идентификатор текущей операционной системы</td>
			</tr>
			<tr>
				<td><b>SUBSYS</b></td>
				<td>Идентификатор текущей подсистемы</td>
			</tr>
			<tr>
				<td><b>CONFIG</b></td>
				<td>Идентификатор текущей конфигурации</td>
			</tr>
		</table>
	</body>
</html>